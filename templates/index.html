<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Orienta√ß√µes Operacionais - PMSC</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f2f2f2; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
        h1 { color: #004080; }
        input[type="text"] { width: 80%; padding: 10px; margin-right: 10px; }
        button { padding: 10px 15px; cursor: pointer; background: #004080; color: white; border: none; border-radius: 4px; margin: 5px 5px 0 0; }
        .resultado { margin-top: 30px; }
        .orientacao {
            background: #e6f0ff;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #004080;
            border-radius: 4px;
            user-select: text;
            position: relative;
        }
        .titulo { font-weight: bold; font-size: 18px; margin-bottom: 10px; color: #00264d; }
        .categoria { font-style: italic; color: #555; }
        .conteudo { white-space: pre-line; margin-top: 10px; }
        a { text-decoration: none; color: #004080; }
    </style>
</head>
<body>
<div class="container">
    <h1>üîç Orienta√ß√µes Operacionais - PMSC</h1>
    <div style="text-align: right;">
        <a href="/logout">üîí Sair</a>
        {% if tipo == 'admin' %} | <a href="/cadastro">‚ûï Cadastrar Usu√°rio</a>{% endif %}
    </div>

    <label for="busca" style="display:none;">Digite o termo</label>
    <input type="text" id="busca" placeholder="Digite o termo...">
    <button onclick="buscar()">Buscar</button>
    <button onclick="copiarTudo()">üìã Copiar Tudo</button>

    {% if tipo == 'admin' %}
    <hr>
    <h2>‚ûï Adicionar Nova Orienta√ß√£o</h2>
    <div class="nova-orientacao">
        <input type="text" id="novoTitulo" placeholder="T√≠tulo" style="width: 100%; margin-bottom: 5px; padding: 8px;">
        <input type="text" id="novaCategoria" placeholder="Categoria" style="width: 100%; margin-bottom: 5px; padding: 8px;">
        <textarea id="novoConteudo" placeholder="Conte√∫do" style="width: 100%; height: 100px; padding: 8px;"></textarea>
        <button onclick="adicionarOrientacao()">Salvar Orienta√ß√£o</button>
    </div>
    {% endif %}

    <div class="resultado" id="resultado"></div>
</div>

<script>
    function buscar() {
        const termo = $('#busca').val().trim();
        if (!termo) {
            alert('Digite um termo para buscar.');
            return;
        }
        $.ajax({
            url: '/buscar',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ termo: termo }),
            success: function(data) {
                $('#resultado').empty();
                if (data.length === 0) {
                    $('#resultado').append('<p>Nenhuma orienta√ß√£o encontrada.</p>');
                    return;
                }
                data.forEach(function(item, index) {
                    const id = 'orientacao_' + index;
                    $('#resultado').append(
                        `<div class="orientacao" id="${id}">
                            <div class="titulo">${item.titulo}</div>
                            <div class="categoria">Categoria: ${item.categoria}</div>
                            <div class="conteudo">${item.conteudo}</div>
                            <button onclick="copiarIndividual('${id}')">üìã Copiar Esta</button>
                            <button onclick="copiarSelecao()">üìã Copiar Sele√ß√£o</button>
                        </div>`
                    );
                });
            }
        });
    }

    $('#busca').on('keypress', function(e) {
        if (e.which === 13) buscar();
    });

    function adicionarOrientacao() {
        const titulo = $('#novoTitulo').val().trim();
        const categoria = $('#novaCategoria').val().trim();
        const conteudo = $('#novoConteudo').val().trim();
        if (!titulo || !categoria || !conteudo) {
            alert("Preencha todos os campos!");
            return;
        }
        $.ajax({
            url: '/adicionar',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ titulo, categoria, conteudo }),
            success: function(data) {
                alert('Orienta√ß√£o adicionada com sucesso!');
                $('#novoTitulo').val('');
                $('#novaCategoria').val('');
                $('#novoConteudo').val('');
                buscar();
            },
            error: function() {
                alert('Erro ao salvar orienta√ß√£o.');
            }
        });
    }

    function copiarTexto(texto) {
        navigator.clipboard.writeText(texto).then(() => {
            alert('Texto copiado para a √°rea de transfer√™ncia!');
        }).catch(err => {
            alert('Erro ao copiar: ' + err);
        });
    }

    function copiarTudo() {
        const textos = [];
        document.querySelectorAll('.orientacao .conteudo').forEach(el => {
            textos.push(el.innerText.trim());
        });
        copiarTexto(textos.join('\n\n'));
    }

    function copiarIndividual(id) {
        const el = document.querySelector(`#${id} .conteudo`);
        if (el) copiarTexto(el.innerText.trim());
    }

    function copiarSelecao() {
        const selecionado = window.getSelection().toString().trim();
        if (selecionado.length > 0) {
            copiarTexto(selecionado);
        } else {
            alert("Voc√™ precisa selecionar um trecho com o mouse antes de clicar.");
        }
    }
</script>
</body>
</html>
